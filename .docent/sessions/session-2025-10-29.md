# Session 2025-10-29

**Date:** 2025-10-29
**Focus:** Fix /docent:ask search bug and implement proactive capture guidance

---

## Summary

Fixed critical search bug in `/docent:ask` that prevented it from finding journals and notes. Added comprehensive proactive capture guidance to encourage agents to use `/docent:tell` frequently. Improved developer experience by making frontmatter `type` field optional with automatic inference.

## Work Completed

### 1. Fixed /docent:ask Search Bug

**Problem:** When asking docent about recent work, it couldn't find `.docent/journals/` or `.docent/notes/` contents.

**Root Cause:** In `/Users/tnez/Code/tnez/docent/src/mcp/tools/ask.ts` lines 153-168, search paths from config were already absolute paths (e.g., `/Users/tnez/Code/tnez/docent/.docent`), but the code was joining them with `projectPath` again, creating invalid doubled paths like `/Users/tnez/Code/tnez/docent/Users/tnez/Code/tnez/docent/.docent`.

**Solution:**

- Removed double-joining in `ask.ts:153-154` - changed from `searchPaths.filter(p => existsSync(join(projectPath, p)))` to `searchPaths.filter(p => existsSync(p))`
- Removed double-joining in `ask.ts:168` - changed from `existingPaths.map(p => join(projectPath, p)).join(' ')` to `existingPaths.join(' ')`
- Fixed error message display to show relative paths for readability

**Files Modified:**

- `/Users/tnez/Code/tnez/docent/src/mcp/tools/ask.ts`

**Verification:** After fix, `/docent:ask what have we been working on recently` successfully searches journals and notes.

### 2. Added Proactive Capture Guidance

**Goal:** Ensure agents use `/docent:tell` frequently to maintain up-to-date project knowledge.

**Changes Made:**

#### A. Updated `/docent:start` Output

- Added prominent "Proactive Capture: Keep Documentation Current" section
- Included 5 critical moments to capture (with checkmarks):
  - ✅ After completing work
  - ✅ When making decisions
  - ✅ Upon discovering insights
  - ✅ When encountering blockers
  - ✅ At natural breakpoints
- Provided 5 concrete examples of good capture statements
- Added "Why this matters" explanation
- Included link to detailed guidance runbook

**File Modified:**

- `/Users/tnez/Code/tnez/docent/src/mcp/tools/start.ts`

#### B. Created Comprehensive Capture Guidance Runbook

- Created `/Users/tnez/Code/tnez/docent/runbooks/capture-work-guidance.md`
- 350+ lines of detailed guidance covering:
  - Philosophy: Documentation as working memory
  - The 5 critical moments (with triggers, what to capture, examples)
  - Capture patterns (good vs bad examples)
  - Anti-patterns to avoid
  - Integration with existing workflows
  - Frequency expectations
  - Verification questions
  - Full session example showing good capture habits
  - Quick capture patterns reference

**Files Created:**

- `/Users/tnez/Code/tnez/docent/runbooks/capture-work-guidance.md`

#### C. Updated Bootstrap Runbook

- Added "Session Initialization for AI Agents" section
- Provides instructions for Claude Code users on configuring `.claude/CLAUDE.md`
- Includes generic guidance for other AI agents
- Shows how to ensure agents initialize docent at session start

**Files Modified:**

- `/Users/tnez/Code/tnez/docent/runbooks/bootstrap.md`

### 3. Improved Developer Experience

**Problem:** Users had to specify `type: runbook` or `type: template` in frontmatter even though files in `runbooks/` are obviously runbooks and files in `templates/` are obviously templates.

**Solution:** Made `type` field optional with automatic inference based on directory:

- Files in `templates/` → inferred as `type: template`
- Files in `runbooks/` → inferred as `type: runbook`
- Users can still explicitly set `type` if desired (manual setting takes precedence)

**Files Modified:**

- `/Users/tnez/Code/tnez/docent/src/core/resource-registry.ts`
  - Updated `parseResource()` to accept optional `inferredType` parameter
  - Modified validation to only require `name` and `description` (not `type`)
  - Updated `loadTemplatesFrom()` to pass `'template'` as inferred type
  - Updated `loadRunbooksFrom()` to pass `'runbook'` as inferred type

**Files Simplified:**

- `/Users/tnez/Code/tnez/docent/runbooks/capture-work-guidance.md` - removed unnecessary `type` field

## Key Decisions

1. **Made `type` field optional in frontmatter** - Reduces verbosity for users. Directory location is sufficient to infer the type.

2. **Proactive capture guidance in `/docent:start`** - Placing it prominently in session initialization ensures every agent sees it at the start of every session.

3. **Comprehensive runbook over brief tips** - Created detailed 350+ line guidance document rather than just bullet points. Agents need concrete examples and anti-patterns to develop good capture habits.

## Testing Performed

- ✅ Built project successfully after each change
- ✅ Restarted MCP server to pick up changes
- ✅ Verified `/docent:start` shows proactive capture section
- ✅ Verified `capture-work-guidance` runbook appears in available runbooks list
- ✅ Invoked `/docent:act capture-work-guidance` - loads successfully
- ✅ Tested `/docent:ask` searching journals - finds content correctly
- ✅ Tested `/docent:tell` - provides appropriate edit instructions

## Files Changed

### Created

- `/Users/tnez/Code/tnez/docent/runbooks/capture-work-guidance.md`

### Modified

- `/Users/tnez/Code/tnez/docent/src/mcp/tools/ask.ts`
- `/Users/tnez/Code/tnez/docent/src/mcp/tools/start.ts`
- `/Users/tnez/Code/tnez/docent/src/core/resource-registry.ts`
- `/Users/tnez/Code/tnez/docent/runbooks/bootstrap.md`

## Next Steps

- Consider committing these changes
- Update CHANGELOG.md with bug fix and new features
- Consider if any other frontmatter fields should be made optional or inferred
- Monitor whether agents actually follow the proactive capture guidance in practice

## Learnings

- **Path handling gotchas**: Always be careful when mixing absolute and relative paths. The `config.ts` was resolving paths to absolute, but downstream code assumed relative and joined again.

- **Developer experience matters**: Even small unnecessary verbosity (like the `type` field) creates friction for users. Inference based on convention (directory location) is better.

- **Declarative tools need clear instructions**: `/docent:tell` correctly identified intent and provided clear instructions for the agent to execute. This declarative pattern works well.

---

**Status:** ✅ Complete - All changes built, tested, and verified working
